<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minecraft-Server-Daten</title>
    <link rel="stylesheet" href="\site\font-faces.css">
    <link rel="icon" href="/favicon.ico" type="image/vnd.microsoft.icon">
</head>
<body>

    <style>
        html {
          font-family: Figtree, sans-serif;
          padding: 2.5rem;
          background-color: #1c1c1c;
        }

        h1 {
            color: #00ffcc;
            font-size: 3rem;
        }

        h3 {
            color: #00ffcc;
            font-size: 1.8rem;
        }

        .mono {
            font-family: Mono, monospace;
            color: whitesmoke;
        }

        .mono > p {
            background-color: #101010;
            border-radius: 0.3rem;
            padding-left: 0.3rem;
            font-size: 1rem;
        }

    </style>

    <h1>Minecraft-Server-Daten</h1>
    <div class="mono" id="server"><p style="font-size: 2rem;">chiro.exaroton.me</p></div>

    <hr>

    <h3>Status:</h3>
    <div class="mono" id="status"><p>Daten werden geladen...</p></div>

    <h3>Auslastung:</h3>
    <div class="mono" id="auslastung-ram"><p>RAM: ... </p></div>
    <div class="mono" id="auslastung-cpu"><p>CPU: ... </p></div>

    <h3>Credits:</h3>
    <div class="mono" id="credits"><p> ... </p></div>

    <h3>Spieler:</h3>
    <div class="mono" id="spieler"><p> ... </p></div>

    <script>
        const SERVER_ID = "EINWOhDy9hlZc31U";
        const PROXY_URL = "https://exaroton-proxy.onrender.com"

        const API_URL = `${PROXY_URL}/api/server/${SERVER_ID}`;
        const UPDATE_INTERVAL = 10000; 

        async function ladeServerDaten() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const result = await response.json();

                const server = result.data;
                if (!server) throw new Error("Keine Daten empfangen");

                // Status
                const statusNamen = [
                    "Offline", "Online", "Starting", "Stopping",
                    "Restarting", "Saving", "Loading", "Crashed", "Preparing"
                ];
                const statusText = statusNamen[server.status] || "Unbekannt";
                document.querySelector("#status p").textContent = statusText;

                // RAM
                const ramUsed = server.ramUsage ?? 0;
                const ramMax = server.ram ?? 0;
                const ramPercent = ramMax ? ((ramUsed / ramMax) * 100).toFixed(0) : 0;
                document.querySelector("#auslastung-ram p").textContent = `RAM: ${ramPercent}% von ${ramMax} MB`;

                // CPU
                const cpuUsed = server.cpuUsage ?? 0;
                document.querySelector("#auslastung-cpu p").textContent = `CPU: ${cpuUsed.toFixed(0)}%`;

                // Credits
                const credits = server.credits ?? "Unbekannt";
                document.querySelector("#credits p").textContent = `${credits} Credits verfügbar`;

                // Spieler
                const players = server.players?.list ?? [];
                document.querySelector("#spieler p").innerHTML = players.length > 0
                    ? players.join("<br>")
                    : "Keine Spieler online";
            } catch (error) {
                console.error("Fehler:", error);
                document.querySelector("#status p").textContent = "Fehler beim Laden";
                document.querySelector("#status p").classList.add("error");
            }
        }

        // Beim Laden sofort ausführen
        ladeServerDaten();

        // Regelmäßig aktualisieren
        setInterval(ladeServerDaten, UPDATE_INTERVAL);
    </script>
</body>
</html>